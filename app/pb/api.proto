syntax = "proto3";

package api;

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

service API {
  rpc Ping(PingReq) returns (PingRes) {
    // Pings the server for updates and basic user info
  }

  rpc GetUser(GetUserReq) returns (User) {
    // Get info about a particular user
  }

  rpc UpdateProfile(UpdateProfileReq) returns (UpdateProfileRes) {
    // Update your profile
  }

  rpc SSO(SSOReq) returns (SSORes) {
    // Performs Discourse SSO
  }
}

message PingReq {}

message PingRes {
  // Basic info about user
  int64 user_id = 1;
  string username = 2;
  string name = 3;

  // Updates
  int64 unread_message_count = 4;
}

message User {
  string username = 1;
  string name = 2;
  string city = 3;
  double verification = 4;
  double community_standing = 5;
  uint32 num_references = 6;
  string gender = 7;
  uint32 age = 8;
  google.protobuf.Timestamp joined = 9; // not exact
  google.protobuf.Timestamp last_active = 10; // not exact
  string occupation = 11;
  string about_me = 12;
  string about_place = 13;
  repeated string languages = 14;
  repeated string countries_visited = 15;
  repeated string countries_lived = 16;
}

message GetUserReq {
  string user = 1;
}

message UpdateProfileReq {
  // These StringValue types allow us to determine if the value is absent versus ""

  google.protobuf.StringValue name = 1;
  google.protobuf.StringValue city = 2;
  google.protobuf.StringValue gender = 3;
  google.protobuf.StringValue occupation = 4;
  google.protobuf.StringValue about_me = 5;
  google.protobuf.StringValue about_place = 6;

  message RepeatedStringValue {
    // A RepeatedStringValue is like a "protobuf warpper" (like {Type}Value) but for repeated strings
    // allows us to determine if the user wanted to remote this list of strings
    bool exists = 1;
    repeated string value = 2;
  }

  RepeatedStringValue languages = 7;
  RepeatedStringValue countries_visited = 8;
  RepeatedStringValue countries_lived = 9;
}

message UpdateProfileRes {
  bool updated_name = 1;
  bool updated_city = 2;
  bool updated_gender = 3;
  bool updated_occupation = 4;
  bool updated_about_me = 5;
  bool updated_about_place = 6;
  bool updated_languages = 7;
  bool updated_countries_visited = 8;
  bool updated_countries_lived = 9;
}

message SSOReq {
  // just raw query strings from discourse
  string sso = 1;
  string sig = 2;
}

message SSORes {
  string redirect_url = 1;
}
